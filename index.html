<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Biblioteca Virtual ISP24</title>
  <link rel="stylesheet" href="styles.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
</head>
<body>
  <header>
    <h1>Biblioteca Virtual ISP24</h1>
  </header>

  <div class="container">
    <aside class="filters">
      <h2>Filtrar</h2>
      <label for="carrera">Carrera:</label>
      <select id="carrera" onchange="updateFilters('carrera')"></select>

      <label for="ciclolectivo">Ciclo lectivo:</label>
      <select id="ciclolectivo" onchange="updateFilters('ciclolectivo')"></select>

      <label for="añocarrera">Año de carrera:</label>
      <select id="añocarrera" onchange="updateFilters('añocarrera')"></select>

      <label for="materia">Materia:</label>
      <select id="materia" onchange="filterData()"></select>
    </aside>

    <section class="results">
      <h2>Resultados</h2>
      <div id="fileList" class="cards"></div>
    </section>
  </div>

  <footer class="footer">
    <h3>Términos de uso</h3>
    <p>Esta biblioteca virtual es de acceso libre y gratuito. Todo el contenido está destinado exclusivamente para fines educativos y no comerciales. El uso responsable de los materiales es fundamental para mantener este recurso disponible para toda la comunidad educativa.</p>
    <div class="donar">
      <h4>¿Querés colaborar?</h4>
      <p><strong>Profesores:</strong> ¿Quieren compartir sus archivos? Pueden enviarlos al número del administrador de la biblioteca virtual: <strong>1123456789</strong></p>
      <p><strong>Alumnos:</strong> ¿Problemas con los archivos? Enviá tus consultas a <a href="mailto:soporte.bibliovirtualisp24@gmail.com">soporte.bibliovirtualisp24@gmail.com</a></p>
      <hr />
      <p>También podés ayudarnos con una donación voluntaria para mantener este servicio.</p>
      <p><strong>Alias para donar:</strong> <code>biblio.isp24</code></p>
    </div>
  </footer>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbwJxUVd3FUGs9vcAkVTgjlagtpGc8YRf0FMZFOICS1kWzHqEZc4bg5F7QFFq8VA_ice/exec";
    let allData = [];

    window.onload = () => {
      fetch(scriptURL)
        .then(res => res.json())
        .then(data => {
          allData = data;
          populateFilters();
          filterData();
        });
    };

    function populateFilters() {
      const carreraSet = new Set();
      const cicloSet = new Set();
      const anioSet = new Set();
      const materiaSet = new Set();

      allData.forEach(item => {
        carreraSet.add(item.Carrera);
        cicloSet.add(item["Ciclo lectivo"]);
        anioSet.add(item["Año de carrera"]);
        materiaSet.add(item.Materia);
      });

      fillSelect("carrera", [...carreraSet]);
      fillSelect("ciclolectivo", [...cicloSet]);
      fillSelect("añocarrera", [...anioSet]);
      fillSelect("materia", [...materiaSet]);
    }

    function fillSelect(id, values) {
      const select = document.getElementById(id);
      select.innerHTML = '<option value="">Todos</option>' + values.sort().map(v => `<option value="${v}">${v}</option>`).join('');
    }

    function updateFilters(changedFilter) {
      const carrera = document.getElementById("carrera").value;
      const ciclo = document.getElementById("ciclolectivo").value;
      const anio = document.getElementById("añocarrera").value;

      const materiasFiltradas = allData.filter(item =>
        (!carrera || item.Carrera === carrera) &&
        (!ciclo || item["Ciclo lectivo"] === ciclo) &&
        (!anio || item["Año de carrera"] === anio)
      );

      const materiaSet = new Set();
      materiasFiltradas.forEach(item => materiaSet.add(item.Materia));
      fillSelect("materia", [...materiaSet]);

      filterData();
    }

    function filterData() {
      const carrera = document.getElementById("carrera").value;
      const ciclo = document.getElementById("ciclolectivo").value;
      const anio = document.getElementById("añocarrera").value;
      const materia = document.getElementById("materia").value;

      const filtered = allData.filter(item =>
        (!carrera || item.Carrera === carrera) &&
        (!ciclo || item["Ciclo lectivo"] === ciclo) &&
        (!anio || item["Año de carrera"] === anio) &&
        (!materia || item.Materia === materia)
      );

      const fileList = document.getElementById("fileList");
      fileList.innerHTML = filtered.map(item => `
        <div class="card">
          <h3>${item.Materia}</h3>
          <p><strong>Carrera:</strong> ${item.Carrera}</p>
          <p><strong>Ciclo:</strong> ${item["Ciclo lectivo"]}</p>
          <p><strong>Año:</strong> ${item["Año de carrera"]}</p>
          <a href="${item.URL}" target="_blank">Ver archivo</a>
        </div>
      `).join("");
    }
  </script>
</body>
</html>
